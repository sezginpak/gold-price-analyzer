{% extends "base.html" %}

{% block title %}Hibrit Analiz Detaylarƒ± - Dezy - Gold Price Analyzer{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="/static/css/modules/market-regime.css">
    <script src="/static/js/market-regime.js"></script>
    <style>
        .indicator-box {
            background: rgba(55, 65, 81, 0.5);
            border: 1px solid rgba(75, 85, 99, 0.5);
        }
        .indicator-box:hover {
            background: rgba(64, 73, 82, 0.7);
        }
        .strength-strong { color: #10b981; }
        .strength-moderate { color: #f59e0b; }
        .strength-weak { color: #6b7280; }
        
        /* Timeframe renkleri - Daha ayƒ±rt edici */
        .timeframe-15m {
            background-color: rgba(59, 130, 246, 0.2); /* Parlak Mavi */
            border-left: 3px solid rgb(59, 130, 246);
        }
        .timeframe-1h {
            background-color: rgba(16, 185, 129, 0.2); /* Z√ºmr√ºt Ye≈üili */
            border-left: 3px solid rgb(16, 185, 129);
        }
        .timeframe-4h {
            background-color: rgba(217, 70, 239, 0.2); /* Mor/Fu≈üya */
            border-left: 3px solid rgb(217, 70, 239);
        }
        .timeframe-1d {
            background-color: rgba(251, 146, 60, 0.2); /* Turuncu */
            border-left: 3px solid rgb(251, 146, 60);
        }
        .timeframe-15m:hover {
            background-color: rgba(59, 130, 246, 0.3);
        }
        .timeframe-1h:hover {
            background-color: rgba(16, 185, 129, 0.3);
        }
        .timeframe-4h:hover {
            background-color: rgba(217, 70, 239, 0.3);
        }
        .timeframe-1d:hover {
            background-color: rgba(251, 146, 60, 0.3);
        }
        
        /* Timeframe badge renkleri */
        .tf-badge-15m {
            background-color: rgb(59, 130, 246);
            color: white;
        }
        .tf-badge-1h {
            background-color: rgb(16, 185, 129);
            color: white;
        }
        .tf-badge-4h {
            background-color: rgb(217, 70, 239);
            color: white;
        }
        .tf-badge-1d {
            background-color: rgb(251, 146, 60);
            color: white;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="space-y-6">
        <!-- Page Title -->
        <h1 class="text-xl lg:text-2xl font-bold gradient-text flex items-center">
            <i class="fas fa-bullseye mr-3 text-yellow-400"></i>
            Hibrit Analiz Detaylarƒ±
        </h1>

        <!-- Zaman Dilimi Se√ßici -->
        <div class="glass-card rounded-lg p-4">
            <label class="text-xs lg:text-sm text-gray-400 mr-2 lg:mr-4">Zaman Dilimi:</label>
            <select id="timeframe-selector" class="bg-slate-700 text-white px-3 py-1 lg:px-4 lg:py-2 rounded text-sm lg:text-base">
                <option value="" selected>T√ºm√º</option>
                <option value="15m">15 Dakika</option>
                <option value="1h">1 Saat</option>
                <option value="4h">4 Saat</option>
                <option value="1d">G√ºnl√ºk</option>
            </select>
        </div>
        
        <!-- Sistem Durumu -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4">
            <div class="glass-card rounded-lg p-3 lg:p-4">
                <p class="text-gray-400 text-xs lg:text-sm">Ana Fiyat</p>
                <p class="text-base lg:text-xl font-bold text-yellow-400">GRAM ALTIN</p>
            </div>
            <div class="glass-card rounded-lg p-3 lg:p-4">
                <p class="text-gray-400 text-xs lg:text-sm">Trend Kaynaƒüƒ±</p>
                <p class="text-base lg:text-xl font-bold text-blue-400">ONS/USD</p>
            </div>
            <div class="glass-card rounded-lg p-3 lg:p-4">
                <p class="text-gray-400 text-xs lg:text-sm">Risk Deƒüerlendirme</p>
                <p class="text-base lg:text-xl font-bold text-red-400">USD/TRY</p>
            </div>
            <div class="glass-card rounded-lg p-3 lg:p-4">
                <p class="text-gray-400 text-xs lg:text-sm">Son Analiz</p>
                <p class="text-base lg:text-xl font-bold" id="last-analysis-time">-</p>
            </div>
        </div>

        <!-- Mevcut Hibrit Analiz -->
        <div class="glass-card rounded-lg p-4 lg:p-6">
            <h3 class="text-lg lg:text-xl font-bold mb-4 flex items-center">
                <i class="fas fa-bolt mr-2 text-yellow-400"></i>
                Mevcut Hibrit Analiz
            </h3>
            <div id="current-hybrid-analysis" class="grid grid-cols-2 lg:grid-cols-3 gap-3 lg:gap-4">
                <div class="bg-slate-800/50 rounded-lg p-3 text-center">
                    <p class="text-gray-400 text-xs lg:text-sm">Sinyal</p>
                    <p class="text-xl lg:text-3xl font-bold" id="current-signal">-</p>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-3 text-center">
                    <p class="text-gray-400 text-xs lg:text-sm">G√ºven</p>
                    <p class="text-xl lg:text-3xl font-bold" id="current-confidence">-</p>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-3 text-center">
                    <p class="text-gray-400 text-xs lg:text-sm">Pozisyon</p>
                    <p class="text-xl lg:text-3xl font-bold" id="current-position">-</p>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-3 text-center">
                    <p class="text-gray-400 text-xs lg:text-sm">Global Trend</p>
                    <p class="text-base lg:text-xl font-bold" id="current-global-trend">-</p>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-3 text-center">
                    <p class="text-gray-400 text-xs lg:text-sm">Kur Riski</p>
                    <p class="text-base lg:text-xl font-bold" id="current-currency-risk">-</p>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-3 text-center">
                    <p class="text-gray-400 text-xs lg:text-sm">Risk/√ñd√ºl</p>
                    <p class="text-base lg:text-xl font-bold" id="current-risk-reward">-</p>
                </div>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-600">
                <h4 class="font-semibold mb-2 text-sm lg:text-base flex items-center">
                    <i class="fas fa-clipboard mr-2 text-blue-400"></i>
                    Analiz √ñzeti
                </h4>
                <p class="text-gray-300 text-xs lg:text-sm" id="current-summary">Y√ºkleniyor...</p>
            </div>
            <div class="mt-4">
                <h4 class="font-semibold mb-2 text-sm lg:text-base flex items-center">
                    <i class="fas fa-lightbulb mr-2 text-yellow-400"></i>
                    √ñneriler
                </h4>
                <ul class="text-gray-300 text-xs lg:text-sm space-y-1" id="current-recommendations">
                    <li>Y√ºkleniyor...</li>
                </ul>
            </div>
        </div>

        <!-- Analiz Bile≈üenleri -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-6">
            <!-- Gram Altƒ±n Analizi -->
            <div class="glass-card rounded-lg p-4 lg:p-6">
                <h3 class="text-base lg:text-lg font-bold mb-4 text-yellow-400 flex items-center">
                    <i class="fas fa-coins mr-2"></i>
                    Gram Altƒ±n Analizi
                </h3>
                <div class="space-y-2 lg:space-y-3">
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Fiyat:</span>
                        <span class="font-bold text-yellow-400" id="gram-price">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Trend:</span>
                        <span class="font-bold" id="gram-trend">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">RSI:</span>
                        <span class="font-bold" id="gram-rsi">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Sinyal:</span>
                        <span class="font-bold" id="gram-signal">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Stop Loss:</span>
                        <span class="font-bold text-red-400" id="gram-stop-loss">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Take Profit:</span>
                        <span class="font-bold text-green-400" id="gram-take-profit">-</span>
                    </div>
                </div>
            </div>

            <!-- Global Trend Analizi -->
            <div class="glass-card rounded-lg p-4 lg:p-6">
                <h3 class="text-base lg:text-lg font-bold mb-4 text-blue-400 flex items-center">
                    <i class="fas fa-globe mr-2"></i>
                    Global Trend Analizi
                </h3>
                <div class="space-y-2 lg:space-y-3">
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Y√∂n:</span>
                        <span class="font-bold" id="global-direction">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">G√º√ß:</span>
                        <span class="font-bold" id="global-strength">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Momentum:</span>
                        <span class="font-bold" id="global-momentum">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Volatilite:</span>
                        <span class="font-bold" id="global-volatility">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Destekleyici:</span>
                        <span class="font-bold" id="global-supportive">-</span>
                    </div>
                </div>
            </div>

            <!-- Kur Riski Analizi -->
            <div class="glass-card rounded-lg p-4 lg:p-6">
                <h3 class="text-base lg:text-lg font-bold mb-4 text-red-400 flex items-center">
                    <i class="fas fa-exchange-alt mr-2"></i>
                    Kur Riski Analizi
                </h3>
                <div class="space-y-2 lg:space-y-3">
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Risk Seviyesi:</span>
                        <span class="font-bold" id="currency-risk-level">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Volatilite:</span>
                        <span class="font-bold" id="currency-volatility">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Pozisyon √áarpan:</span>
                        <span class="font-bold" id="currency-multiplier">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">M√ºdahale Riski:</span>
                        <span class="font-bold" id="intervention-risk">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Trend Uyumu:</span>
                        <span class="font-bold" id="currency-trend-align">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Geli≈ümi≈ü G√∂stergeler -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6 mb-6">
            <!-- CCI & MFI G√∂stergeleri -->
            <div class="glass-card rounded-lg p-4 lg:p-6">
                <h3 class="text-base lg:text-lg font-bold mb-4 text-indigo-400 flex items-center">
                    <i class="fas fa-chart-line mr-2"></i>
                    Geli≈ümi≈ü G√∂stergeler
                </h3>
                <div class="space-y-2 lg:space-y-3">
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">CCI:</span>
                        <span class="font-bold" id="cci-value">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">CCI Sinyal:</span>
                        <span class="font-bold" id="cci-signal">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">MFI:</span>
                        <span class="font-bold" id="mfi-value">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">MFI Sinyal:</span>
                        <span class="font-bold" id="mfi-signal">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Birle≈üik Sinyal:</span>
                        <span class="font-bold" id="advanced-signal">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Diverjans:</span>
                        <span class="font-bold" id="divergence">-</span>
                    </div>
                </div>
            </div>

            <!-- Pattern Analizi -->
            <div class="glass-card rounded-lg p-4 lg:p-6">
                <h3 class="text-base lg:text-lg font-bold mb-4 text-purple-400 flex items-center">
                    <i class="fas fa-shapes mr-2"></i>
                    Pattern Tanƒ±ma
                </h3>
                <div class="space-y-2 lg:space-y-3">
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Pattern Bulundu:</span>
                        <span class="font-bold" id="pattern-found">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Pattern Adƒ±:</span>
                        <span class="font-bold" id="pattern-name">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Pattern Sinyal:</span>
                        <span class="font-bold" id="pattern-signal">-</span>
                    </div>
                    <div class="flex justify-between text-sm lg:text-base">
                        <span class="text-gray-400">Pattern G√ºven:</span>
                        <span class="font-bold" id="pattern-confidence">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Risk Y√∂netimi -->
        <div class="glass-card rounded-lg p-4 lg:p-6 mb-6">
            <h3 class="text-base lg:text-lg font-bold mb-4 text-orange-400 flex items-center">
                <i class="fas fa-shield-alt mr-2"></i>
                Kelly Criterion Risk Y√∂netimi
            </h3>
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4">
                <div class="bg-slate-800/50 rounded-lg p-3 text-center">
                    <p class="text-gray-400 text-xs lg:text-sm">Lot Sayƒ±sƒ±</p>
                    <p class="text-base lg:text-xl font-bold" id="kelly-lots">-</p>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-3 text-center">
                    <p class="text-gray-400 text-xs lg:text-sm">Risk %</p>
                    <p class="text-base lg:text-xl font-bold" id="kelly-risk">-</p>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-3 text-center">
                    <p class="text-gray-400 text-xs lg:text-sm">Ayarlƒ± G√ºven</p>
                    <p class="text-base lg:text-xl font-bold" id="adjusted-confidence">-</p>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-3 text-center">
                    <p class="text-gray-400 text-xs lg:text-sm">Volatilite %</p>
                    <p class="text-base lg:text-xl font-bold" id="market-volatility">-</p>
                </div>
            </div>
        </div>

        <!-- Market Regime Detection -->
        <div class="market-regime-widget mb-6">
            <div class="regime-header">
                <h2 class="regime-title">
                    <i class="fas fa-brain text-purple-400"></i>
                    Market Rejim Analizi
                </h2>
                <div class="regime-status active" id="analysis-regime-status">Y√ºkleniyor...</div>
            </div>
            
            <!-- Transition Alert -->
            <div id="analysis-transition-alert" class="transition-alert" style="display: none;"></div>
            
            <!-- Detailed Regime Analysis -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4">
                <!-- Volatilite Detay -->
                <div class="regime-indicator">
                    <div class="regime-indicator-icon">
                        <i class="fas fa-wave-square text-cyan-400"></i>
                    </div>
                    <div class="regime-indicator-label">Volatilite Rejimi</div>
                    <div class="regime-indicator-value" id="analysis-volatility-level">-</div>
                    <div class="regime-indicator-desc" id="analysis-volatility-desc">Y√ºkleniyor...</div>
                    <svg class="regime-gauge" id="analysis-volatility-gauge" width="120" height="120">
                    </svg>
                </div>
                
                <!-- Trend Detay -->
                <div class="regime-indicator">
                    <div class="regime-indicator-icon">
                        <i class="fas fa-chart-line text-green-400"></i>
                    </div>
                    <div class="regime-indicator-label">Trend Rejimi</div>
                    <div class="regime-indicator-value" id="analysis-trend-type">-</div>
                    <div class="regime-indicator-desc" id="analysis-trend-desc">Y√ºkleniyor...</div>
                    <svg class="regime-gauge" id="analysis-trend-gauge" width="120" height="120">
                    </svg>
                </div>
                
                <!-- Momentum Detay -->
                <div class="regime-indicator">
                    <div class="regime-indicator-icon">
                        <i class="fas fa-tachometer-alt text-orange-400"></i>
                    </div>
                    <div class="regime-indicator-label">Momentum Rejimi</div>
                    <div class="regime-indicator-value" id="analysis-momentum-state">-</div>
                    <div class="regime-indicator-desc" id="analysis-momentum-desc">Y√ºkleniyor...</div>
                    <svg class="regime-gauge" id="analysis-momentum-gauge" width="120" height="120">
                    </svg>
                </div>
            </div>
            
            <!-- Regime Alerts -->
            <div id="analysis-regime-alerts" class="regime-alerts" style="display: none;"></div>
            
            <!-- Regime History Chart -->
            <div class="regime-history-container">
                <div class="regime-history-header">
                    <h4 class="text-sm font-semibold text-yellow-400 mb-2">
                        <i class="fas fa-history mr-2"></i>
                        Rejim Ge√ßmi≈üi
                    </h4>
                    <div class="regime-history-controls">
                        <button class="regime-history-btn active" data-period="6">6 Saat</button>
                        <button class="regime-history-btn" data-period="12">12 Saat</button>
                        <button class="regime-history-btn" data-period="24">24 Saat</button>
                        <button class="regime-history-btn" data-period="48">48 Saat</button>
                    </div>
                </div>
                <div style="position: relative; height: 200px;">
                    <canvas id="analysis-regime-history-chart"></canvas>
                </div>
            </div>
            
            <!-- Detailed Adaptive Parameters -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mt-4">
                <div class="adaptive-params">
                    <h4>
                        <i class="fas fa-cogs mr-2"></i>
                        RSI Adaptive Parametreler
                    </h4>
                    <div id="analysis-rsi-params" class="params-grid">
                        <div class="param-item">
                            <span class="param-label">A≈üƒ±rƒ± Alƒ±m</span>
                            <span class="param-value" id="analysis-rsi-overbought">-</span>
                        </div>
                        <div class="param-item">
                            <span class="param-label">A≈üƒ±rƒ± Satƒ±m</span>
                            <span class="param-value" id="analysis-rsi-oversold">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="adaptive-params">
                    <h4>
                        <i class="fas fa-sliders-h mr-2"></i>
                        Risk Y√∂netimi Parametreleri
                    </h4>
                    <div id="analysis-risk-params" class="params-grid">
                        <div class="param-item">
                            <span class="param-label">Stop Loss √áarpan</span>
                            <span class="param-value" id="analysis-stop-multiplier">-</span>
                        </div>
                        <div class="param-item">
                            <span class="param-label">Take Profit √áarpan</span>
                            <span class="param-value" id="analysis-tp-multiplier">-</span>
                        </div>
                        <div class="param-item">
                            <span class="param-label">Pozisyon Ayarƒ±</span>
                            <span class="param-value" id="analysis-position-adjustment">-</span>
                        </div>
                        <div class="param-item">
                            <span class="param-label">Sinyal E≈üiƒüi</span>
                            <span class="param-value" id="analysis-signal-threshold">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Regime Recommendations -->
            <div class="mt-4 pt-4 border-t border-gray-600">
                <h4 class="font-semibold mb-2 text-sm lg:text-base flex items-center">
                    <i class="fas fa-lightbulb mr-2 text-yellow-400"></i>
                    Rejim Bazlƒ± √ñneriler
                </h4>
                <div id="analysis-regime-recommendations" class="grid grid-cols-1 lg:grid-cols-2 gap-3">
                    <div class="bg-slate-800/50 rounded-lg p-3">
                        <div class="text-xs text-gray-400 mb-1">Strateji</div>
                        <div class="text-sm font-semibold" id="analysis-strategy-recommendation">Y√ºkleniyor...</div>
                    </div>
                    <div class="bg-slate-800/50 rounded-lg p-3">
                        <div class="text-xs text-gray-400 mb-1">Pozisyon Boyutu</div>
                        <div class="text-sm font-semibold" id="analysis-position-recommendation">Y√ºkleniyor...</div>
                    </div>
                    <div class="bg-slate-800/50 rounded-lg p-3">
                        <div class="text-xs text-gray-400 mb-1">Zaman Ufku</div>
                        <div class="text-sm font-semibold" id="analysis-timeframe-recommendation">Y√ºkleniyor...</div>
                    </div>
                    <div class="bg-slate-800/50 rounded-lg p-3">
                        <div class="text-xs text-gray-400 mb-1">Piyasa Fazƒ±</div>
                        <div class="text-sm font-semibold" id="analysis-phase-recommendation">Y√ºkleniyor...</div>
                    </div>
                </div>
                <div class="mt-3">
                    <div class="text-xs text-gray-400 mb-1">Uyarƒ±lar ve Fƒ±rsatlar</div>
                    <div id="analysis-warnings-opportunities" class="text-xs text-gray-300 bg-slate-800/30 rounded p-2">
                        Y√ºkleniyor...
                    </div>
                </div>
            </div>
        </div>

        <!-- Detaylƒ± G√∂stergeler -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6 mb-6">
            <!-- Teknik G√∂stergeler -->
            <div class="glass-card rounded-lg p-4 lg:p-6">
                <h3 class="text-base lg:text-lg font-bold mb-4 text-blue-400 flex items-center">
                    <i class="fas fa-chart-line mr-2"></i>
                    Teknik G√∂stergeler
                </h3>
                <div class="grid grid-cols-2 gap-3" id="technical-indicators">
                    <div class="bg-slate-800/50 rounded-lg p-3">
                        <p class="text-xs text-gray-400">RSI</p>
                        <p class="text-lg font-bold" id="rsi-value">-</p>
                        <p class="text-xs" id="rsi-signal">-</p>
                    </div>
                    <div class="bg-slate-800/50 rounded-lg p-3">
                        <p class="text-xs text-gray-400">MACD</p>
                        <p class="text-lg font-bold" id="macd-value">-</p>
                        <p class="text-xs" id="macd-trend">-</p>
                    </div>
                    <div class="bg-slate-800/50 rounded-lg p-3">
                        <p class="text-xs text-gray-400">Stochastic</p>
                        <p class="text-lg font-bold" id="stoch-value">-</p>
                        <p class="text-xs" id="stoch-zone">-</p>
                    </div>
                    <div class="bg-slate-800/50 rounded-lg p-3">
                        <p class="text-xs text-gray-400">ATR</p>
                        <p class="text-lg font-bold" id="atr-value">-</p>
                        <p class="text-xs" id="atr-volatility">-</p>
                    </div>
                </div>
            </div>

            <!-- Bollinger & Pattern -->
            <div class="glass-card rounded-lg p-4 lg:p-6">
                <h3 class="text-base lg:text-lg font-bold mb-4 text-purple-400 flex items-center">
                    <i class="fas fa-layer-group mr-2"></i>
                    Bollinger & Pattern
                </h3>
                <div class="space-y-3">
                    <div class="bg-slate-800/50 rounded-lg p-3">
                        <p class="text-xs text-gray-400">Bollinger Position</p>
                        <p class="text-lg font-bold" id="bb-position">-</p>
                        <p class="text-xs" id="bb-signal">-</p>
                    </div>
                    <div class="bg-slate-800/50 rounded-lg p-3">
                        <p class="text-xs text-gray-400">Pattern</p>
                        <p class="text-sm font-bold" id="pattern-name">-</p>
                        <p class="text-xs" id="pattern-confidence">-</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Support/Resistance Levels -->
        <div class="glass-card rounded-lg p-4 lg:p-6 mb-6">
            <h3 class="text-base lg:text-lg font-bold mb-4 text-orange-400 flex items-center">
                <i class="fas fa-layer-group mr-2"></i>
                Destek/Diren√ß Seviyeleri
            </h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                <div>
                    <h4 class="text-sm font-semibold text-green-400 mb-2">Destek Seviyeleri</h4>
                    <div id="support-levels" class="space-y-2">
                        <!-- Dinamik olarak doldurulacak -->
                    </div>
                </div>
                <div>
                    <h4 class="text-sm font-semibold text-red-400 mb-2">Diren√ß Seviyeleri</h4>
                    <div id="resistance-levels" class="space-y-2">
                        <!-- Dinamik olarak doldurulacak -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Hibrit Analiz Ge√ßmi≈üi -->
        <div class="glass-card rounded-lg p-4 lg:p-6">
            <div class="flex flex-wrap items-center justify-between mb-4">
                <h3 class="text-lg lg:text-xl font-bold flex items-center">
                    <i class="fas fa-history mr-2 text-purple-400"></i>
                    Hibrit Analiz Ge√ßmi≈üi
                </h3>
                <div class="flex items-center gap-2 text-xs mt-2 lg:mt-0">
                    <span class="text-gray-400">Renk kodlarƒ±:</span>
                    <span class="px-2 py-1 rounded tf-badge-15m font-semibold">15D</span>
                    <span class="px-2 py-1 rounded tf-badge-1h font-semibold">1S</span>
                    <span class="px-2 py-1 rounded tf-badge-4h font-semibold">4S</span>
                    <span class="px-2 py-1 rounded tf-badge-1d font-semibold">1G</span>
                </div>
            </div>
            
            <!-- Filtreleme Alanƒ± -->
            <div class="mb-4 grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-3">
                <!-- Tarih Aralƒ±ƒüƒ± -->
                <div>
                    <label class="text-xs text-gray-400 mb-1 block">Ba≈ülangƒ±√ß</label>
                    <input type="datetime-local" id="start-date" class="w-full bg-slate-700 text-white px-3 py-2 rounded text-sm">
                </div>
                <div>
                    <label class="text-xs text-gray-400 mb-1 block">Biti≈ü</label>
                    <input type="datetime-local" id="end-date" class="w-full bg-slate-700 text-white px-3 py-2 rounded text-sm">
                </div>
                
                <!-- Sinyal Tipi Filtresi -->
                <div>
                    <label class="text-xs text-gray-400 mb-1 block">Sinyal Tipi</label>
                    <select id="signal-filter" class="w-full bg-slate-700 text-white px-3 py-2 rounded text-sm">
                        <option value="">T√ºm√º</option>
                        <option value="BUY">Alƒ±≈ü</option>
                        <option value="SELL">Satƒ±≈ü</option>
                        <option value="HOLD">Bekle</option>
                    </select>
                </div>
                
                <!-- Filtre Butonlarƒ± -->
                <div class="flex items-end gap-2">
                    <button onclick="applyFilters()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm transition">
                        <i class="fas fa-filter mr-1"></i> Filtrele
                    </button>
                    <button onclick="resetFilters()" class="bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded text-sm transition">
                        <i class="fas fa-undo mr-1"></i> Sƒ±fƒ±rla
                    </button>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-xs lg:text-sm">
                    <thead>
                        <tr class="border-b border-gray-700">
                            <th class="text-left py-1 lg:py-2 hidden lg:table-cell">Zaman</th>
                            <th class="text-left py-1 lg:py-2">TF</th>
                            <th class="text-left py-1 lg:py-2">Fiyat</th>
                            <th class="text-left py-1 lg:py-2">Sinyal</th>
                            <th class="text-left py-1 lg:py-2 hidden sm:table-cell">G√º√ß</th>
                            <th class="text-left py-1 lg:py-2">G√ºven</th>
                            <th class="text-left py-1 lg:py-2 hidden md:table-cell">RSI</th>
                            <th class="text-left py-1 lg:py-2 hidden md:table-cell">Trend</th>
                            <th class="text-left py-1 lg:py-2 hidden md:table-cell">Global</th>
                            <th class="text-left py-1 lg:py-2 hidden md:table-cell">Risk</th>
                            <th class="text-left py-1 lg:py-2 hidden lg:table-cell">R/R</th>
                        </tr>
                    </thead>
                    <tbody id="hybrid-analysis-history">
                        <tr>
                            <td colspan="11" class="text-center py-4 text-gray-400 text-sm">
                                Y√ºkleniyor...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Sayfalama -->
            <div class="mt-4 flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="text-sm text-gray-400">
                    <span id="showing-info">1-20 arasƒ± g√∂steriliyor</span>
                    <span id="total-count" class="ml-2"></span>
                </div>
                <div class="flex items-center gap-2">
                    <button id="prev-page" onclick="changePage(-1)" class="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded text-sm transition disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span id="page-info" class="text-sm">Sayfa 1</span>
                    <button id="next-page" onclick="changePage(1)" class="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded text-sm transition disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="flex items-center gap-2">
                    <label class="text-xs text-gray-400">Sayfa ba≈üƒ±na:</label>
                    <select id="per-page" onchange="changePerPage()" class="bg-slate-700 text-white px-2 py-1 rounded text-sm">
                        <option value="20">20</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        // Sayfalama deƒüi≈ükenleri
        let currentPage = 1;
        let perPage = 20;
        let totalAnalyses = 0;
        let allAnalysisData = [];
        
        // Tarih formatƒ± d√ºzeltme (local datetime-local input i√ßin)
        function formatDateForInput(date) {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            const hours = String(d.getHours()).padStart(2, '0');
            const minutes = String(d.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }
        
        // Sayfa y√ºklendiƒüinde varsayƒ±lan tarih aralƒ±ƒüƒ±nƒ± ayarla
        window.addEventListener('DOMContentLoaded', function() {
            // Son 24 saat
            const now = new Date();
            const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);
            
            document.getElementById('start-date').value = formatDateForInput(yesterday);
            document.getElementById('end-date').value = formatDateForInput(now);
        });
        
        // RSI renk fonksiyonu
        function getRSIColor(rsi) {
            if (!rsi) return '';
            if (rsi > 70) return 'text-red-400';  // A≈üƒ±rƒ± alƒ±m
            if (rsi < 30) return 'text-green-400'; // A≈üƒ±rƒ± satƒ±m
            if (rsi > 60) return 'text-orange-400'; // Y√ºksek
            if (rsi < 40) return 'text-blue-400';   // D√º≈ü√ºk
            return 'text-gray-400'; // Normal
        }
        
        // Hibrit analiz verilerini y√ºkle
        async function loadHybridAnalysisData() {
            try {
                // URL parametrelerini olu≈ütur
                const params = new URLSearchParams();
                
                // Temel parametreler
                params.append('page', currentPage);
                params.append('per_page', perPage);
                
                // Filtreler
                const timeframe = document.getElementById('timeframe-selector').value;
                if (timeframe) params.append('timeframe', timeframe);
                
                const startDate = document.getElementById('start-date').value;
                if (startDate) params.append('start_date', new Date(startDate).toISOString());
                
                const endDate = document.getElementById('end-date').value;
                if (endDate) params.append('end_date', new Date(endDate).toISOString());
                
                const signalType = document.getElementById('signal-filter').value;
                if (signalType) params.append('signal_type', signalType);
                
                // API √ßaƒürƒ±larƒ±
                const historyUrl = `/api/analysis/history?${params.toString()}`;
                const detailsUrl = timeframe ? `/api/analysis/details?timeframe=${timeframe}` : '/api/analysis/details';
                
                const [historyResponse, detailsResponse] = await Promise.all([
                    fetch(historyUrl),
                    fetch(detailsUrl)
                ]);
                
                if (!historyResponse.ok || !detailsResponse.ok) {
                    throw new Error('API hatasƒ±');
                }
                
                const historyData = await historyResponse.json();
                const detailsData = await detailsResponse.json();
                
                // Veriyi g√∂ster
                displayHistoryData(historyData.analyses || []);
                
                // Sayfalama bilgilerini g√ºncelle
                if (historyData.pagination) {
                    totalAnalyses = historyData.pagination.total;
                    updatePaginationInfo();
                }
                
                // En son analizi g√∂ster
                if (historyData.analyses && historyData.analyses.length > 0 && currentPage === 1) {
                    updateCurrentAnalysis(historyData.analyses[0]);
                }
                
                // Detaylƒ± g√∂stergeleri y√ºkle
                if (detailsData.analyses && detailsData.analyses.length > 0) {
                    updateDetailedIndicators(detailsData.analyses[0]);
                }
                
                // Aktif pattern'leri y√ºkle
                loadActivePatterns();
                
                // Timeframe bazlƒ± g√∂stergeleri y√ºkle
                if (timeframe) {
                    loadTimeframeIndicators(timeframe);
                }
                
            } catch (error) {
                console.error('Veri y√ºkleme hatasƒ±:', error);
            }
        }
        
        // Aktif pattern'leri y√ºkle
        async function loadActivePatterns() {
            try {
                const response = await fetch('/api/analysis/patterns/active');
                const data = await response.json();
                
                if (data.patterns && data.patterns.length > 0) {
                    // Pattern listesini g√ºncelle
                    const patternList = data.patterns.map(pattern => {
                        const confidenceClass = pattern.confidence > 0.8 ? 'text-green-400' :
                                              pattern.confidence > 0.6 ? 'text-yellow-400' : 'text-gray-400';
                        return `
                            <div class="bg-slate-800/50 rounded p-2 mb-2">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold">${pattern.name}</span>
                                    <span class="text-xs bg-slate-700 px-2 py-1 rounded">${pattern.timeframe}</span>
                                </div>
                                <div class="flex justify-between text-xs text-gray-400 mt-1">
                                    <span>Tip: ${pattern.type}</span>
                                    <span class="${confidenceClass}">G√ºven: %${(pattern.confidence * 100).toFixed(0)}</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    // Pattern b√∂l√ºm√ºne ekle (ileride eklenecek)
                }
            } catch (error) {
                console.error('Pattern y√ºkleme hatasƒ±:', error);
            }
        }
        
        // Timeframe bazlƒ± g√∂stergeleri y√ºkle
        async function loadTimeframeIndicators(timeframe) {
            try {
                const response = await fetch(`/api/analysis/indicators/${timeframe}`);
                const data = await response.json();
                
                if (!data.error) {
                    // G√∂stergeleri g√ºncelle
                    console.log('Timeframe g√∂stergeleri:', data);
                }
            } catch (error) {
                console.error('G√∂sterge y√ºkleme hatasƒ±:', error);
            }
        }
        
        // Filtreleri uygula
        function applyFilters() {
            currentPage = 1; // Filtre uygulandƒ±ƒüƒ±nda ilk sayfaya d√∂n
            loadHybridAnalysisData();
        }
        
        // Filtreleri sƒ±fƒ±rla
        function resetFilters() {
            const now = new Date();
            const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);
            
            document.getElementById('start-date').value = formatDateForInput(yesterday);
            document.getElementById('end-date').value = formatDateForInput(now);
            document.getElementById('signal-filter').value = '';
            document.getElementById('timeframe-selector').value = '';
            
            currentPage = 1;
            loadHybridAnalysisData();
        }
        
        // Sayfa deƒüi≈ütir
        function changePage(direction) {
            const newPage = currentPage + direction;
            const maxPage = Math.ceil(totalAnalyses / perPage);
            
            if (newPage >= 1 && newPage <= maxPage) {
                currentPage = newPage;
                loadHybridAnalysisData();
            }
        }
        
        // Sayfa ba≈üƒ±na g√∂sterim sayƒ±sƒ±nƒ± deƒüi≈ütir
        function changePerPage() {
            perPage = parseInt(document.getElementById('per-page').value);
            currentPage = 1; // ƒ∞lk sayfaya d√∂n
            loadHybridAnalysisData();
        }
        
        // Ge√ßmi≈ü verilerini g√∂ster
        function displayHistoryData(analyses) {
            try {
                
                if (analyses && analyses.length > 0) {
                    
                    // Analiz ge√ßmi≈üini g√∂ster
                    const historyHtml = analyses.map(analysis => {
                        const date = new Date(analysis.timestamp);
                        // Timestamp zaten T√ºrkiye saatinde geliyor, ekleme yapma
                        
                        const timeframeClass = `timeframe-${analysis.timeframe}`;
                        return `
                            <tr class="border-b border-gray-700 ${timeframeClass} transition-colors">
                                <td class="py-1 lg:py-2 text-xs lg:text-sm hidden lg:table-cell">${date.toLocaleTimeString('tr-TR')}</td>
                                <td class="py-1 lg:py-2 text-xs lg:text-sm font-semibold">${analysis.timeframe}</td>
                                <td class="py-1 lg:py-2 text-xs lg:text-sm">‚Ç∫${analysis.price.toFixed(2)}</td>
                                <td class="py-1 lg:py-2">
                                    <span class="${analysis.signal === 'BUY' ? 'signal-buy' : 
                                                  analysis.signal === 'SELL' ? 'signal-sell' : 
                                                  'signal-hold'} font-bold text-xs lg:text-sm">
                                        ${analysis.signal === 'BUY' ? 'üü¢' : 
                                          analysis.signal === 'SELL' ? 'üî¥' : 
                                          '‚ö™'}
                                        <span class="hidden sm:inline">
                                            ${analysis.signal === 'BUY' ? 'AL' : 
                                              analysis.signal === 'SELL' ? 'SAT' : 
                                              'BEKLE'}
                                        </span>
                                    </span>
                                </td>
                                <td class="py-1 lg:py-2 hidden sm:table-cell">
                                    <span class="${analysis.signal_strength === 'STRONG' ? 'strength-strong' : 
                                                  analysis.signal_strength === 'MODERATE' ? 'strength-moderate' : 
                                                  'strength-weak'} text-xs lg:text-sm">
                                        ${analysis.signal_strength.charAt(0)}
                                    </span>
                                </td>
                                <td class="py-1 lg:py-2 text-xs lg:text-sm">%${(analysis.confidence * 100).toFixed(0)}</td>
                                <td class="py-1 lg:py-2 hidden md:table-cell">
                                    <span class="${getRSIColor(analysis.details?.gram?.rsi || analysis.rsi_value)} text-xs lg:text-sm">
                                        ${analysis.details?.gram?.rsi?.toFixed(0) || analysis.rsi_value?.toFixed(0) || '-'}
                                    </span>
                                </td>
                                <td class="py-1 lg:py-2 hidden md:table-cell">
                                    <span class="${analysis.trend === 'UPTREND' ? 'text-green-400' : 
                                                  analysis.trend === 'DOWNTREND' ? 'text-red-400' : 
                                                  'text-yellow-400'} text-xs lg:text-sm">
                                        ${analysis.trend === 'UPTREND' ? '‚Üë' : 
                                          analysis.trend === 'DOWNTREND' ? '‚Üì' : 
                                          '‚Üí'}
                                    </span>
                                </td>
                                <td class="py-1 lg:py-2 hidden md:table-cell">
                                    <span class="${analysis.global_trend === 'BULLISH' ? 'text-green-400' : 
                                                  analysis.global_trend === 'BEARISH' ? 'text-red-400' : 
                                                  'text-yellow-400'} text-xs lg:text-sm">
                                        ${analysis.global_trend === 'BULLISH' ? 'üìà' : 
                                          analysis.global_trend === 'BEARISH' ? 'üìâ' : 
                                          '‚û°Ô∏è'}
                                    </span>
                                </td>
                                <td class="py-1 lg:py-2 hidden md:table-cell">
                                    <span class="${analysis.currency_risk === 'LOW' ? 'text-green-400' : 
                                                  analysis.currency_risk === 'MEDIUM' ? 'text-yellow-400' : 
                                                  analysis.currency_risk === 'HIGH' ? 'text-red-400' : 
                                                  'text-red-600'} text-xs lg:text-sm">
                                        ${analysis.currency_risk === 'LOW' ? 'L' : 
                                          analysis.currency_risk === 'MEDIUM' ? 'M' : 
                                          analysis.currency_risk === 'HIGH' ? 'H' : 'X'}
                                    </span>
                                </td>
                                <td class="py-1 lg:py-2 text-xs lg:text-sm hidden lg:table-cell">${analysis.risk_reward_ratio ? analysis.risk_reward_ratio.toFixed(1) : '-'}</td>
                            </tr>
                        `;
                    }).join('');
                    
                    document.getElementById('hybrid-analysis-history').innerHTML = historyHtml;
                } else {
                    document.getElementById('hybrid-analysis-history').innerHTML = 
                        '<tr><td colspan="11" class="text-center py-4 text-gray-400">Hen√ºz hibrit analiz yok</td></tr>';
                }
                
                // Son analiz zamanƒ±
                document.getElementById('last-analysis-time').textContent = 
                    new Date().toLocaleTimeString('tr-TR');
                    
            } catch (error) {
                console.error('Hibrit analiz verileri y√ºklenemedi:', error);
                document.getElementById('hybrid-analysis-history').innerHTML = 
                    '<tr><td colspan="11" class="text-center py-4 text-red-400">Y√ºklenemedi</td></tr>';
            }
        }

        // Mevcut analizi g√ºncelle
        function updateCurrentAnalysis(analysis) {
            // Ana metrikler
            const signalClass = analysis.signal === 'BUY' ? 'signal-buy' : 
                               analysis.signal === 'SELL' ? 'signal-sell' : 'signal-hold';
            const signalText = analysis.signal === 'BUY' ? 'üü¢ ALI≈û' : 
                              analysis.signal === 'SELL' ? 'üî¥ SATI≈û' : '‚ö™ BEKLE';
            
            document.getElementById('current-signal').className = `text-xl lg:text-3xl font-bold ${signalClass}`;
            document.getElementById('current-signal').textContent = signalText;
            document.getElementById('current-confidence').textContent = `%${(analysis.confidence * 100).toFixed(0)}`;
            document.getElementById('current-position').textContent = `%${(analysis.position_size * 100).toFixed(0)}`;
            
            // Global trend
            const globalTrendClass = analysis.global_trend === 'BULLISH' ? 'text-green-400' : 
                                   analysis.global_trend === 'BEARISH' ? 'text-red-400' : 'text-yellow-400';
            document.getElementById('current-global-trend').className = `text-base lg:text-xl font-bold ${globalTrendClass}`;
            document.getElementById('current-global-trend').textContent = 
                `${analysis.global_trend} (${analysis.global_trend_strength})`;
            
            // Kur riski
            const currencyRiskClass = analysis.currency_risk === 'LOW' ? 'text-green-400' : 
                                    analysis.currency_risk === 'MEDIUM' ? 'text-yellow-400' : 
                                    analysis.currency_risk === 'HIGH' ? 'text-red-400' : 'text-red-600';
            document.getElementById('current-currency-risk').className = `text-base lg:text-xl font-bold ${currencyRiskClass}`;
            document.getElementById('current-currency-risk').textContent = analysis.currency_risk;
            
            // Risk/√ñd√ºl
            document.getElementById('current-risk-reward').textContent = 
                analysis.risk_reward_ratio ? `1:${analysis.risk_reward_ratio.toFixed(2)}` : '-';
            
            // √ñzet ve √∂neriler
            document.getElementById('current-summary').textContent = analysis.summary;
            
            if (analysis.recommendations && analysis.recommendations.length > 0) {
                const recommendationsHtml = analysis.recommendations.map(rec => 
                    `<li class="mb-1">‚Ä¢ ${rec}</li>`
                ).join('');
                document.getElementById('current-recommendations').innerHTML = recommendationsHtml;
            } else {
                document.getElementById('current-recommendations').innerHTML = '<li>√ñneri yok</li>';
            }
            
            // Detay analizleri
            if (analysis.details) {
                updateDetailedAnalysis(analysis.details);
            }
            
            // Stop loss ve take profit
            document.getElementById('gram-stop-loss').textContent = 
                analysis.stop_loss ? `‚Ç∫${analysis.stop_loss.toFixed(2)}` : '-';
            document.getElementById('gram-take-profit').textContent = 
                analysis.take_profit ? `‚Ç∫${analysis.take_profit.toFixed(2)}` : '-';
            
            // Gram altƒ±n fiyatƒ±
            document.getElementById('gram-price').textContent = `‚Ç∫${analysis.price.toFixed(2)}`;
            
            // Yeni g√∂stergeler - Advanced Indicators
            if (analysis.details && analysis.details.advanced_indicators) {
                const adv = analysis.details.advanced_indicators;
                document.getElementById('cci-value').textContent = adv.cci !== null ? adv.cci.toFixed(2) : '-';
                document.getElementById('cci-signal').textContent = adv.cci_signal || '-';
                document.getElementById('mfi-value').textContent = adv.mfi !== null ? adv.mfi.toFixed(2) : '-';
                document.getElementById('mfi-signal').textContent = adv.mfi_signal || '-';
                document.getElementById('advanced-signal').textContent = adv.combined_signal || '-';
                document.getElementById('divergence').textContent = adv.divergence ? 'Var' : 'Yok';
            }
            
            // Pattern tanƒ±ma
            if (analysis.details && analysis.details.pattern) {
                const pattern = analysis.details.pattern;
                document.getElementById('pattern-found').textContent = pattern.found ? 'Evet' : 'Hayƒ±r';
                document.getElementById('pattern-name').textContent = pattern.name || '-';
                document.getElementById('pattern-signal').textContent = pattern.signal || '-';
                document.getElementById('pattern-confidence').textContent = 
                    pattern.confidence ? `%${(pattern.confidence * 100).toFixed(0)}` : '-';
            }
            
            // Kelly Criterion Risk Y√∂netimi
            if (analysis.position_details) {
                const pos = analysis.position_details;
                document.getElementById('kelly-lots').textContent = pos.lots || '-';
                document.getElementById('kelly-risk').textContent = 
                    pos.risk_percentage ? `%${pos.risk_percentage.toFixed(1)}` : '-';
                document.getElementById('adjusted-confidence').textContent = 
                    pos.adjusted_confidence ? `%${(pos.adjusted_confidence * 100).toFixed(0)}` : '-';
                document.getElementById('market-volatility').textContent = 
                    pos.market_volatility ? `%${pos.market_volatility.toFixed(1)}` : '-';
            }
        }

        // Detaylƒ± g√∂stergeleri g√ºncelle
        function updateDetailedIndicators(analysis) {
            try {
                const gramAnalysis = analysis.gram_analysis || {};
                const indicators = gramAnalysis.indicators || {};
                const patterns = gramAnalysis.patterns || [];
                const supportLevels = gramAnalysis.support_levels || [];
                const resistanceLevels = gramAnalysis.resistance_levels || [];
                
                // RSI
                if (indicators.rsi !== undefined) {
                    document.getElementById('rsi-value').textContent = indicators.rsi.toFixed(1);
                    document.getElementById('rsi-signal').textContent = indicators.rsi_signal || 'neutral';
                } else {
                    document.getElementById('rsi-value').textContent = '-';
                    document.getElementById('rsi-signal').textContent = '-';
                }
                
                // MACD
                if (indicators.macd) {
                    const macd = indicators.macd;
                    document.getElementById('macd-value').textContent = 
                        macd.macd_line !== null ? macd.macd_line.toFixed(2) : '-';
                    document.getElementById('macd-trend').textContent = macd.trend || '-';
                } else {
                    document.getElementById('macd-value').textContent = '-';
                    document.getElementById('macd-trend').textContent = '-';
                }
                
                // Stochastic
                if (indicators.stochastic) {
                    const stoch = indicators.stochastic;
                    document.getElementById('stoch-value').textContent = 
                        `K:${stoch.k ? stoch.k.toFixed(1) : '-'}`;
                    document.getElementById('stoch-zone').textContent = stoch.zone || '-';
                } else {
                    document.getElementById('stoch-value').textContent = '-';
                    document.getElementById('stoch-zone').textContent = '-';
                }
                
                // ATR
                if (indicators.atr) {
                    const atr = indicators.atr;
                    document.getElementById('atr-value').textContent = 
                        atr.atr ? atr.atr.toFixed(2) : '-';
                    document.getElementById('atr-volatility').textContent = 
                        atr.volatility_level || '-';
                } else {
                    document.getElementById('atr-value').textContent = '-';
                    document.getElementById('atr-volatility').textContent = '-';
                }
                
                // Bollinger Bands
                if (indicators.bollinger) {
                    const bb = indicators.bollinger;
                    document.getElementById('bb-position').textContent = bb.position || '-';
                    document.getElementById('bb-signal').textContent = bb.signal || '-';
                } else {
                    document.getElementById('bb-position').textContent = '-';
                    document.getElementById('bb-signal').textContent = '-';
                }
                
                // Pattern
                if (patterns.length > 0) {
                    const pattern = patterns[0]; // En g√ºvenilir pattern
                    document.getElementById('pattern-name').textContent = pattern.name || '-';
                    document.getElementById('pattern-confidence').textContent = 
                        pattern.confidence ? `%${(pattern.confidence * 100).toFixed(0)}` : '-';
                } else {
                    document.getElementById('pattern-name').textContent = 'Yok';
                    document.getElementById('pattern-confidence').textContent = '-';
                }
                
                // Support Levels
                const supportHtml = supportLevels.slice(0, 5).map(level => 
                    `<div class="bg-slate-800/50 rounded p-2">
                        <span class="text-green-400">‚Ç∫${level.level.toFixed(2)}</span>
                        <span class="text-xs text-gray-400 ml-2">${level.strength}</span>
                    </div>`
                ).join('');
                document.getElementById('support-levels').innerHTML = 
                    supportHtml || '<div class="text-gray-400 text-sm">Veri yok</div>';
                
                // Resistance Levels
                const resistanceHtml = resistanceLevels.slice(0, 5).map(level => 
                    `<div class="bg-slate-800/50 rounded p-2">
                        <span class="text-red-400">‚Ç∫${level.level.toFixed(2)}</span>
                        <span class="text-xs text-gray-400 ml-2">${level.strength}</span>
                    </div>`
                ).join('');
                document.getElementById('resistance-levels').innerHTML = 
                    resistanceHtml || '<div class="text-gray-400 text-sm">Veri yok</div>';
                
            } catch (error) {
                console.error('Detaylƒ± g√∂sterge g√ºncellemesi hatasƒ±:', error);
            }
        }

        // Detaylƒ± analiz bile≈üenlerini g√ºncelle
        function updateDetailedAnalysis(details) {
            // Gram altƒ±n detaylarƒ±
            if (details.gram) {
                const gram = details.gram;
                document.getElementById('gram-trend').textContent = gram.trend || '-';
                document.getElementById('gram-rsi').textContent = gram.rsi ? gram.rsi.toFixed(1) : '-';
                document.getElementById('gram-signal').textContent = gram.signal || '-';
            }
            
            // Global trend detaylarƒ±
            if (details.global) {
                const global = details.global;
                document.getElementById('global-direction').textContent = global.trend_direction || '-';
                document.getElementById('global-strength').textContent = global.trend_strength || '-';
                document.getElementById('global-momentum').textContent = global.momentum?.signal || '-';
                document.getElementById('global-volatility').textContent = global.volatility?.level || '-';
                document.getElementById('global-supportive').textContent = global.supportive ? 'Evet' : 'Hayƒ±r';
            }
            
            // Kur riski detaylarƒ±
            if (details.currency) {
                const currency = details.currency;
                document.getElementById('currency-risk-level').textContent = currency.risk_level || '-';
                document.getElementById('currency-volatility').textContent = currency.volatility?.level || '-';
                document.getElementById('currency-multiplier').textContent = 
                    currency.position_size_multiplier ? `x${currency.position_size_multiplier.toFixed(2)}` : '-';
                document.getElementById('intervention-risk').textContent = 
                    currency.intervention_risk?.has_risk ? 'Var' : 'Yok';
                document.getElementById('currency-trend-align').textContent = 
                    currency.trend_alignment ? 'Uyumlu' : 'Uyumsuz';
            }
        }

        // Sayfalama bilgilerini g√ºncelle
        function updatePaginationInfo() {
            const maxPage = Math.ceil(totalAnalyses / perPage);
            const startItem = totalAnalyses > 0 ? (currentPage - 1) * perPage + 1 : 0;
            const endItem = Math.min(currentPage * perPage, totalAnalyses);
            
            document.getElementById('showing-info').textContent = 
                totalAnalyses > 0 ? `${startItem}-${endItem} arasƒ± g√∂steriliyor` : 'Veri yok';
            document.getElementById('total-count').textContent = `(Toplam: ${totalAnalyses})`;
            document.getElementById('page-info').textContent = `Sayfa ${currentPage} / ${maxPage || 1}`;
            
            // Buton durumlarƒ±
            document.getElementById('prev-page').disabled = currentPage <= 1;
            document.getElementById('next-page').disabled = currentPage >= maxPage;
        }
        
        // Sayfa y√ºklendiƒüinde
        loadHybridAnalysisData();
        
        // Timeframe deƒüi≈üimi
        document.getElementById('timeframe-selector').addEventListener('change', function() {
            currentPage = 1; // ƒ∞lk sayfaya d√∂n
            loadHybridAnalysisData();
        });
        
        // Her 30 saniyede bir g√ºncelle
        setInterval(loadHybridAnalysisData, 30000);
    </script>
{% endblock %}