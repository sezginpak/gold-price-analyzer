<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hibrit Analiz Detaylarƒ± - Gold Price Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #111827; color: #f3f4f6; }
        .analysis-card { background-color: #1f2937; }
        .indicator-box {
            background: #374151;
            border: 1px solid #4b5563;
        }
        .indicator-box:hover {
            background: #404952;
        }
        .signal-buy { color: #10b981; }
        .signal-sell { color: #ef4444; }
        .signal-hold { color: #6b7280; }
        .strength-strong { color: #10b981; }
        .strength-moderate { color: #f59e0b; }
        .strength-weak { color: #6b7280; }
    </style>
</head>
<body>
    <!-- Menu -->
    <div id="menu-container"></div>

    <div class="container mx-auto px-4">
        <h2 class="text-2xl font-bold mb-6">üéØ Hibrit Analiz Detaylarƒ±</h2>
        
        <!-- Zaman Dilimi Se√ßici -->
        <div class="analysis-card rounded-lg p-4 mb-6">
            <label class="text-sm text-gray-400 mr-4">Zaman Dilimi:</label>
            <select id="timeframe-selector" class="bg-gray-700 text-white px-4 py-2 rounded">
                <option value="">T√ºm√º</option>
                <option value="15m" selected>15 Dakika</option>
                <option value="1h">1 Saat</option>
                <option value="4h">4 Saat</option>
                <option value="1d">G√ºnl√ºk</option>
            </select>
        </div>
        
        <!-- Sistem Durumu -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="analysis-card rounded-lg p-4">
                <p class="text-gray-400 text-sm">Ana Fiyat</p>
                <p class="text-xl font-bold text-yellow-400">GRAM ALTIN</p>
            </div>
            <div class="analysis-card rounded-lg p-4">
                <p class="text-gray-400 text-sm">Trend Kaynaƒüƒ±</p>
                <p class="text-xl font-bold text-blue-400">ONS/USD</p>
            </div>
            <div class="analysis-card rounded-lg p-4">
                <p class="text-gray-400 text-sm">Risk Deƒüerlendirme</p>
                <p class="text-xl font-bold text-red-400">USD/TRY</p>
            </div>
            <div class="analysis-card rounded-lg p-4">
                <p class="text-gray-400 text-sm">Son Analiz</p>
                <p class="text-xl font-bold" id="last-analysis-time">-</p>
            </div>
        </div>

        <!-- Mevcut Hibrit Analiz -->
        <div class="analysis-card rounded-lg p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">‚ö° Mevcut Hibrit Analiz</h3>
            <div id="current-hybrid-analysis" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="text-center">
                    <p class="text-gray-400 text-sm">Sinyal</p>
                    <p class="text-3xl font-bold" id="current-signal">-</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-400 text-sm">G√ºven</p>
                    <p class="text-3xl font-bold" id="current-confidence">-</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-400 text-sm">Pozisyon</p>
                    <p class="text-3xl font-bold" id="current-position">-</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-400 text-sm">Global Trend</p>
                    <p class="text-xl font-bold" id="current-global-trend">-</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-400 text-sm">Kur Riski</p>
                    <p class="text-xl font-bold" id="current-currency-risk">-</p>
                </div>
                <div class="text-center">
                    <p class="text-gray-400 text-sm">Risk/√ñd√ºl</p>
                    <p class="text-xl font-bold" id="current-risk-reward">-</p>
                </div>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-600">
                <h4 class="font-semibold mb-2">üìã Analiz √ñzeti</h4>
                <p class="text-gray-300" id="current-summary">Y√ºkleniyor...</p>
            </div>
            <div class="mt-4">
                <h4 class="font-semibold mb-2">üí° √ñneriler</h4>
                <ul class="text-gray-300" id="current-recommendations">
                    <li>Y√ºkleniyor...</li>
                </ul>
            </div>
        </div>

        <!-- Analiz Bile≈üenleri -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <!-- Gram Altƒ±n Analizi -->
            <div class="analysis-card rounded-lg p-6">
                <h3 class="text-lg font-bold mb-4 text-yellow-400">üí∞ Gram Altƒ±n Analizi</h3>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Fiyat:</span>
                        <span class="font-bold" id="gram-price">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Trend:</span>
                        <span class="font-bold" id="gram-trend">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">RSI:</span>
                        <span class="font-bold" id="gram-rsi">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Sinyal:</span>
                        <span class="font-bold" id="gram-signal">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Stop Loss:</span>
                        <span class="font-bold" id="gram-stop-loss">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Take Profit:</span>
                        <span class="font-bold" id="gram-take-profit">-</span>
                    </div>
                </div>
            </div>

            <!-- Global Trend Analizi -->
            <div class="analysis-card rounded-lg p-6">
                <h3 class="text-lg font-bold mb-4 text-blue-400">üåç Global Trend Analizi</h3>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Y√∂n:</span>
                        <span class="font-bold" id="global-direction">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">G√º√ß:</span>
                        <span class="font-bold" id="global-strength">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Momentum:</span>
                        <span class="font-bold" id="global-momentum">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Volatilite:</span>
                        <span class="font-bold" id="global-volatility">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Destekleyici:</span>
                        <span class="font-bold" id="global-supportive">-</span>
                    </div>
                </div>
            </div>

            <!-- Kur Riski Analizi -->
            <div class="analysis-card rounded-lg p-6">
                <h3 class="text-lg font-bold mb-4 text-red-400">üí± Kur Riski Analizi</h3>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Risk Seviyesi:</span>
                        <span class="font-bold" id="currency-risk-level">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Volatilite:</span>
                        <span class="font-bold" id="currency-volatility">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Pozisyon √áarpan:</span>
                        <span class="font-bold" id="currency-multiplier">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">M√ºdahale Riski:</span>
                        <span class="font-bold" id="intervention-risk">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Trend Uyumu:</span>
                        <span class="font-bold" id="currency-trend-align">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hibrit Analiz Ge√ßmi≈üi -->
        <div class="analysis-card rounded-lg p-6">
            <h3 class="text-xl font-bold mb-4">üìä Hibrit Analiz Ge√ßmi≈üi</h3>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-700">
                            <th class="text-left py-2">Zaman</th>
                            <th class="text-left py-2">TF</th>
                            <th class="text-left py-2">Fiyat</th>
                            <th class="text-left py-2">Sinyal</th>
                            <th class="text-left py-2">G√º√ß</th>
                            <th class="text-left py-2">G√ºven</th>
                            <th class="text-left py-2">Pozisyon</th>
                            <th class="text-left py-2">Global</th>
                            <th class="text-left py-2">Kur Risk</th>
                            <th class="text-left py-2">R/R</th>
                        </tr>
                    </thead>
                    <tbody id="hybrid-analysis-history">
                        <tr>
                            <td colspan="10" class="text-center py-4 text-gray-400">
                                Y√ºkleniyor...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Menu y√ºkle
        fetch('/menu')
            .then(response => response.text())
            .then(html => {
                document.getElementById('menu-container').innerHTML = html;
            });

        // Hibrit analiz verilerini y√ºkle
        async function loadHybridAnalysisData() {
            try {
                const timeframe = document.getElementById('timeframe-selector').value;
                const url = timeframe ? `/api/analysis/history?timeframe=${timeframe}` : '/api/analysis/history';
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('API hatasƒ±');
                }
                
                const data = await response.json();
                
                if (data.analyses && data.analyses.length > 0) {
                    // En son analizi g√∂ster
                    const latest = data.analyses[0];
                    updateCurrentAnalysis(latest);
                    
                    // Analiz ge√ßmi≈üini g√∂ster
                    const historyHtml = data.analyses.map(analysis => {
                        const date = new Date(analysis.timestamp);
                        const trDate = new Date(date.getTime() + (3 * 60 * 60 * 1000)); // UTC+3
                        
                        return `
                            <tr class="border-b border-gray-700">
                                <td class="py-2 text-sm">${trDate.toLocaleTimeString('tr-TR')}</td>
                                <td class="py-2 text-sm">${analysis.timeframe}</td>
                                <td class="py-2">‚Ç∫${analysis.price.toFixed(2)}</td>
                                <td class="py-2">
                                    <span class="${analysis.signal === 'BUY' ? 'signal-buy' : 
                                                  analysis.signal === 'SELL' ? 'signal-sell' : 
                                                  'signal-hold'} font-bold">
                                        ${analysis.signal === 'BUY' ? 'üü¢ AL' : 
                                          analysis.signal === 'SELL' ? 'üî¥ SAT' : 
                                          '‚ö™ BEKLE'}
                                    </span>
                                </td>
                                <td class="py-2">
                                    <span class="${analysis.signal_strength === 'STRONG' ? 'strength-strong' : 
                                                  analysis.signal_strength === 'MODERATE' ? 'strength-moderate' : 
                                                  'strength-weak'} text-sm">
                                        ${analysis.signal_strength}
                                    </span>
                                </td>
                                <td class="py-2">%${(analysis.confidence * 100).toFixed(0)}</td>
                                <td class="py-2">%${(analysis.position_size * 100).toFixed(0)}</td>
                                <td class="py-2">
                                    <span class="${analysis.global_trend === 'BULLISH' ? 'text-green-400' : 
                                                  analysis.global_trend === 'BEARISH' ? 'text-red-400' : 
                                                  'text-yellow-400'} text-sm">
                                        ${analysis.global_trend}
                                    </span>
                                </td>
                                <td class="py-2">
                                    <span class="${analysis.currency_risk === 'LOW' ? 'text-green-400' : 
                                                  analysis.currency_risk === 'MEDIUM' ? 'text-yellow-400' : 
                                                  analysis.currency_risk === 'HIGH' ? 'text-red-400' : 
                                                  'text-red-600'} text-sm">
                                        ${analysis.currency_risk}
                                    </span>
                                </td>
                                <td class="py-2">${analysis.risk_reward_ratio ? analysis.risk_reward_ratio.toFixed(2) : '-'}</td>
                            </tr>
                        `;
                    }).join('');
                    
                    document.getElementById('hybrid-analysis-history').innerHTML = historyHtml;
                } else {
                    document.getElementById('hybrid-analysis-history').innerHTML = 
                        '<tr><td colspan="10" class="text-center py-4 text-gray-400">Hen√ºz hibrit analiz yok</td></tr>';
                }
                
                // Son analiz zamanƒ±
                document.getElementById('last-analysis-time').textContent = 
                    new Date(Date.now() + (3 * 60 * 60 * 1000)).toLocaleTimeString('tr-TR');
                    
            } catch (error) {
                console.error('Hibrit analiz verileri y√ºklenemedi:', error);
                document.getElementById('hybrid-analysis-history').innerHTML = 
                    '<tr><td colspan="10" class="text-center py-4 text-red-400">Y√ºklenemedi</td></tr>';
            }
        }

        // Mevcut analizi g√ºncelle
        function updateCurrentAnalysis(analysis) {
            // Ana metrikler
            const signalClass = analysis.signal === 'BUY' ? 'signal-buy' : 
                               analysis.signal === 'SELL' ? 'signal-sell' : 'signal-hold';
            const signalText = analysis.signal === 'BUY' ? 'üü¢ ALI≈û' : 
                              analysis.signal === 'SELL' ? 'üî¥ SATI≈û' : '‚ö™ BEKLE';
            
            document.getElementById('current-signal').className = `text-3xl font-bold ${signalClass}`;
            document.getElementById('current-signal').textContent = signalText;
            document.getElementById('current-confidence').textContent = `%${(analysis.confidence * 100).toFixed(0)}`;
            document.getElementById('current-position').textContent = `%${(analysis.position_size * 100).toFixed(0)}`;
            
            // Global trend
            const globalTrendClass = analysis.global_trend === 'BULLISH' ? 'text-green-400' : 
                                   analysis.global_trend === 'BEARISH' ? 'text-red-400' : 'text-yellow-400';
            document.getElementById('current-global-trend').className = `text-xl font-bold ${globalTrendClass}`;
            document.getElementById('current-global-trend').textContent = 
                `${analysis.global_trend} (${analysis.global_trend_strength})`;
            
            // Kur riski
            const currencyRiskClass = analysis.currency_risk === 'LOW' ? 'text-green-400' : 
                                    analysis.currency_risk === 'MEDIUM' ? 'text-yellow-400' : 
                                    analysis.currency_risk === 'HIGH' ? 'text-red-400' : 'text-red-600';
            document.getElementById('current-currency-risk').className = `text-xl font-bold ${currencyRiskClass}`;
            document.getElementById('current-currency-risk').textContent = analysis.currency_risk;
            
            // Risk/√ñd√ºl
            document.getElementById('current-risk-reward').textContent = 
                analysis.risk_reward_ratio ? `1:${analysis.risk_reward_ratio.toFixed(2)}` : '-';
            
            // √ñzet ve √∂neriler
            document.getElementById('current-summary').textContent = analysis.summary;
            
            if (analysis.recommendations && analysis.recommendations.length > 0) {
                const recommendationsHtml = analysis.recommendations.map(rec => 
                    `<li class="mb-1">‚Ä¢ ${rec}</li>`
                ).join('');
                document.getElementById('current-recommendations').innerHTML = recommendationsHtml;
            } else {
                document.getElementById('current-recommendations').innerHTML = '<li>√ñneri yok</li>';
            }
            
            // Detay analizleri
            if (analysis.details) {
                updateDetailedAnalysis(analysis.details);
            }
            
            // Stop loss ve take profit
            document.getElementById('gram-stop-loss').textContent = 
                analysis.stop_loss ? `‚Ç∫${analysis.stop_loss.toFixed(2)}` : '-';
            document.getElementById('gram-take-profit').textContent = 
                analysis.take_profit ? `‚Ç∫${analysis.take_profit.toFixed(2)}` : '-';
            
            // Gram altƒ±n fiyatƒ±
            document.getElementById('gram-price').textContent = `‚Ç∫${analysis.price.toFixed(2)}`;
        }

        // Detaylƒ± analiz bile≈üenlerini g√ºncelle
        function updateDetailedAnalysis(details) {
            // Gram altƒ±n detaylarƒ±
            if (details.gram) {
                const gram = details.gram;
                document.getElementById('gram-trend').textContent = gram.trend || '-';
                document.getElementById('gram-rsi').textContent = gram.rsi ? gram.rsi.toFixed(1) : '-';
                document.getElementById('gram-signal').textContent = gram.signal || '-';
            }
            
            // Global trend detaylarƒ±
            if (details.global) {
                const global = details.global;
                document.getElementById('global-direction').textContent = global.trend_direction || '-';
                document.getElementById('global-strength').textContent = global.trend_strength || '-';
                document.getElementById('global-momentum').textContent = global.momentum?.signal || '-';
                document.getElementById('global-volatility').textContent = global.volatility?.level || '-';
                document.getElementById('global-supportive').textContent = global.supportive ? 'Evet' : 'Hayƒ±r';
            }
            
            // Kur riski detaylarƒ±
            if (details.currency) {
                const currency = details.currency;
                document.getElementById('currency-risk-level').textContent = currency.risk_level || '-';
                document.getElementById('currency-volatility').textContent = currency.volatility?.level || '-';
                document.getElementById('currency-multiplier').textContent = 
                    currency.position_size_multiplier ? `x${currency.position_size_multiplier.toFixed(2)}` : '-';
                document.getElementById('intervention-risk').textContent = 
                    currency.intervention_risk?.has_risk ? 'Var' : 'Yok';
                document.getElementById('currency-trend-align').textContent = 
                    currency.trend_alignment ? 'Uyumlu' : 'Uyumsuz';
            }
        }

        // Sayfa y√ºklendiƒüinde
        loadHybridAnalysisData();
        
        // Timeframe deƒüi≈üimi
        document.getElementById('timeframe-selector').addEventListener('change', function() {
            loadHybridAnalysisData();
        });
        
        // Her 30 saniyede bir g√ºncelle
        setInterval(loadHybridAnalysisData, 30000);
    </script>
</body>
</html>